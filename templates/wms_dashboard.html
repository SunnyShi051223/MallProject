{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12 mb-4">
        <h2 class="border-bottom pb-2 text-primary">ğŸ“¦ WMS ä¾›åº”é“¾ç®¡ç†ä¸­å¿ƒ</h2>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm border-0 bg-light">
            <div class="card-header bg-primary text-white fw-bold">
                <i class="bi bi-box-seam"></i> å…¥åº“æ“ä½œ (è¡¥è´§)
            </div>
            <div class="card-body">
                <form id="stock-form">
                    <div class="mb-3">
                        <label class="form-label fw-bold">1. é€‰æ‹©ç›®æ ‡ä»“åº“</label>
                        <select class="form-select" name="ware_id">
                            {% for w in warehouses %}
                            <option value="{{ w.id }}">{{ w.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">2. é€‰æ‹©å…¥åº“å•†å“ (SKU)</label>
                        <select class="form-select" name="sku_id">
                            {% for sku in skus %}
                            <option value="{{ sku.id }}">
                                {{ sku.product_name }} [{{ sku.sp_data }}]
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">3. è¡¥è´§æ•°é‡</label>
                        <input type="number" name="quantity" class="form-control" value="50" min="1">
                    </div>

                    <button type="button" onclick="addStock()" class="btn btn-primary w-100 py-2">
                        ç¡®è®¤å…¥åº“
                    </button>
                </form>
            </div>
        </div>

        <div class="alert alert-warning mt-3 small">
            <strong>ç³»ç»Ÿæç¤ºï¼š</strong><br>
            æ­¤å¤„æ¨¡æ‹Ÿä¾›åº”é“¾å…¥åº“æµç¨‹ã€‚<br>
            æäº¤åï¼ŒWMSè¡¨(ç‰©ç†åº“å­˜)å’ŒPMSè¡¨(é”€å”®åº“å­˜)çš„æ•°æ®å°†<b>åŒæ­¥å¢åŠ </b>ï¼Œè¯·è°¨æ…æ“ä½œã€‚
        </div>
    </div>

    <div class="col-md-8">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white fw-bold">
                <i class="bi bi-list-ul"></i> å½“å‰åº“å­˜åˆ†å¸ƒæ€»è§ˆ
            </div>
            <div class="card-body p-0">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>æ‰€åœ¨ä»“åº“</th>
                            <th>å•†å“åç§°</th>
                            <th>è§„æ ¼</th>
                            <th class="text-center">ç‰©ç†åº“å­˜</th>
                            <th class="text-center">é”å®š (å¾…å‘è´§)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for s in stocks %}
                        <tr>
                            <td><span class="badge bg-secondary">{{ s.ware_name }}</span></td>
                            <td class="fw-bold">{{ s.product_name }}</td>
                            <td><small class="text-muted">{{ s.sp_data }}</small></td>
                            <td class="text-center text-success fw-bold fs-5">{{ s.stock }}</td>
                            <td class="text-center text-danger">{{ s.stock_locked }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center py-5 text-muted">
                                æš‚æ— åº“å­˜è®°å½•ï¼Œè¯·åœ¨å·¦ä¾§è¿›è¡Œç¬¬ä¸€æ¬¡è¡¥è´§ã€‚
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    function addStock() {
        // ç®€å•çš„å‰ç«¯æ ¡éªŒ
        var qty = $('input[name="quantity"]').val();
        if(qty <= 0) {
            alert("æ•°é‡å¿…é¡»å¤§äº0");
            return;
        }

        $.post('/wms/add_stock', $('#stock-form').serialize(), function(res){
            if(res.code === 200) {
                alert("âœ… " + res.msg);
                location.reload(); // åˆ·æ–°é¡µé¢æŸ¥çœ‹æœ€æ–°åº“å­˜
            } else {
                alert("âŒ æ“ä½œå¤±è´¥: " + res.msg);
            }
        }).fail(function() {
            alert("ç½‘ç»œè¿æ¥å¤±è´¥");
        });
    }
</script>
{% endblock %}